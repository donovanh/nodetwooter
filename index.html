<html>
  <head>
    <title>Tweets - Embed Twitter searches</title>
    <link href="stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel="stylesheet" type="text/css">
  </head>
  <body>
    <article class="content">
      <h1 id="responsive_headline">Tweets</h1>
      <p class="slogan">Embed Twitter search results in your site using JavaScript.</p>
      <div class="tweets" data-search="hop.ie"></div>

      <p>Twitter no longer allows embedded tweets using pure JavaScript, as all requests require authentication. This means we can no longer use the Twitter API with only JavaScript.</p>
      <h2>Try it yourself</h2>
      <p>If you're comfortable setting up a Node.js app, you can <a href="http://github.com/donovanh/tweets">grab the source code</a> and set up your own Tweets service.</p>
      <p><a href="http://github.com/donovanh/tweets">Tweets</a> is a server-side app that provides Twitter search results, with the correct authentication in place. It is currently available as a Node.js app that you host on your own servers or elsewhere.</p>
      <p>Download <a href="http://github.com/donovanh/tweets">the Tweets Node.js app</a> here.</p>
    </article>
    <footer class="clearfix">
      <section class="footer-content">
        <p>This is a <a href="http://hop.ie/about">Donovan Hutchinson</a> project.</p>
        <p>You can follow me at <a href="http://twitter.com/donovanh">@donovanh</a> for updates.</p>
        <p class="copy">&copy; Donovan Hutchinson</p>
      </section>
    </footer>


    <script src="http://code.jquery.com/jquery-2.0.0.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0-rc.3/handlebars.min.js"></script>
    <script src="js/jquery.fittext.js"></script>
    <script>
      $.each($('.tweets'), function(index, tweetbox) {
        // Get the 'data-search' value and search Twitter for any results
        var searchPhrase = $(tweetbox).attr('data-search');
        if (searchPhrase.length > 0) {
          $.get('http://tweets.hop.ie/search/'+searchPhrase, function(data) {
            var outputHTML = '';
            $.each(data.results, function(index, tweet) {
              tweet.text = replaceURLWithHTMLLinks(tweet.text);
              var source = $("#tweet-template").html();
              var template = Handlebars.compile(source);
              outputHTML += template(tweet);
            });
            $(tweetbox).html(outputHTML);
          });
        }
      });
      $("#responsive_headline").fitText(0.38);
    </script>
    <script type="text/x-handlebars-template" id="tweet-template">
      <article class="tweet">
        <section class="user-details">
          <a href="http://twitter.com/{{from_user}}">
            <div class="user-image" style="background-image: url({{profile_image_url}})"></div>
            <p>
              <strong>{{from_user_name}}</strong>
              <span>{{from_user}}</span>
            </p>
          </a>
        </section>
        <p class="text">{{{text}}}</p>
        <p class="timing"><a href="http://twitter.com/{{from_user}}/statuses/{{id_str}}">{{created_at}}</a></p>
      </article>
    </script>
  </body>
</html>

<script>
function replaceURLWithHTMLLinks(text) {
  var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
  return text.replace(exp,"<a href='$1'>$1</a>"); 
}
</script>